# 目标管理模块使用与验收说明

## 导入模板
- 支持文件类型：CSV（逗号分隔值）。
- 必填列：`业务类型`、`年度目标（万）`，区分大小写。
- 导入后仅更新微调目标（TUNED）版本，年初目标（INIT）始终锁定。
- 建议从示例模板复制：

```
业务类型,年度目标（万）
车险整体,43100
10吨以上-普货,450
...
```

## 页面入口与结构
- 页面入口：导航栏「年度目标」标签或访问 `/targets`。
- 顶部「版本概览」卡片同时展示年初/微调目标总计与签单保费累计达成值。
- 右侧为「目标导入 / 导出」卡片，提供 react-dropzone（拖拽上传库）与 PapaParse（CSV 解析库）驱动的导入体验。
- 下方「年度目标双轨对比」表格包含年初/微调目标、达成率、缺口及总目标占比列。

## 实时数据口径
- 「已达成（万）」来源：当前筛选结果内所有记录的 `signed_premium_yuan`（签单保费，单位：元）求和后除以 10000，保留两位小数。
- 达成率：采用 `已达成 ÷ 目标`，通过 `goalCalculator` 工具函数统一保留两位小数并在分母为 0 时返回 `—`。
- 缺口：`目标 − 已达成`，保留一位小数；负值在表格中以红色显示表示超额完成。
- 总目标占比：`年初目标 ÷ 年初目标总计`，仅当输入提供该列时展示。

## 错误清单提示
- 缺少必填列或列名错误。
- 业务类型为空、重复或不在预设列表。
- 年度目标（万）为空、非数字或为负数。
- 解析错误会弹出弹窗（Dialog），逐条列出行号与问题描述。
- 未知业务类型默认阻断导入；如需忽略，可调整 `unknownBusinessStrategy` 为 `ignore`（开发配置）。

## 版本切换与撤销
- 通过「目标版本」下拉选择；年初目标右侧显示 🔒，提示不可修改/删除。
- 导入成功后自动创建新版本（命名：`{年度}-微调目标-{日期}`），并自动切换。
- 若同日导入多次，会自动追加 `_#编号` 保持唯一。
- 撤销按钮用于回到导入前状态，仅记录内存快照。

## 导出规则
- 「导出当前版本」按钮基于当前选中版本生成 CSV。
- 文件名格式：`{版本名}_{YYYYMMDD}.csv`，示例：`2025-微调目标-20251021_20250120.csv`。
- 导出内容仅包含两列：`业务类型`、`年度目标（万）`，以当前版本口径写出。

## 验收要点
1. 无法删除或修改年初目标版本，锁定状态提示清晰。
2. 导入合法 CSV 后，微调目标列更新，达成率/缺口联动刷新。
3. 切换任意历史版本导出时，文件名与内容符合规则。
4. 不合法 CSV 被阻断，错误弹窗展示完整列表。
5. 分母为 0 的达成率显示 `—`，并提供 tooltip 说明。
