# 车险数据分析平台 - 动态知识库

> **核心原则**: 代码是唯一事实 (Code is the Single Source of Truth)
>
> 本文档基于代码分析自动生成,确保与实际实现严格一致。
> 最后同步时间: **2025-01-20 23:58 UTC**

---

## 📊 项目概览

### 基本信息
- **项目名称**: 车险多维可视化智能数据分析网页
- **当前版本**: MVP v1.0 (Beta)
- **技术栈**: React 18 + TypeScript + Next.js 14 + Zustand
- **部署状态**: 🚧 开发环境
- **代码健康度**: 73% 平均完整度

### 快速链接
- [协作约定](./00_conventions.md) - 必读!理解"代码优先"原则
- [功能清单](./01_features/) - 7个核心功能模块
- [架构决策](./02_decisions/) - 技术选型和设计原理
- [开发日志](./03_logs/) - 变更历史和问题记录
- [历史归档](./archive/) - 旧文档归档

---

## 🎯 功能实现状态

> 数据来源: `node analyze-codebase.js` 自动分析
> 最后运行: 2025-01-20 23:58

### 总体统计
- **已实现功能**: 0/7 (0%)
- **开发中功能**: 7/7 (100%)
- **待开始功能**: 0/7 (0%)
- **平均完整度**: 73%

### 按优先级分类

#### 🔥 P0 - 核心功能 (必须)
| ID | 功能名称 | 状态 | 完整度 | 快速链接 |
|----|---------|------|--------|---------|
| F001 | 数据上传与解析模块 | 🚧 部分完成 | 80% | [详情](./01_features/F001_data_import/README.md) |
| F002 | 核心KPI看板模块 | 🚧 部分完成 | 80% | [详情](./01_features/F002_kpi_dashboard/README.md) |
| F003 | 趋势分析图表模块 | 🚧 部分完成 | 70% | [详情](./01_features/F003_trend_analysis/README.md) |
| F004 | 多维度筛选模块 | 🚧 部分完成 | 70% | [详情](./01_features/F004_filters/README.md) |

**P0功能状态**: 4/4核心文件已实现,但部分增强功能待完善

#### ⚡ P1 - 重要功能
| ID | 功能名称 | 状态 | 完整度 | 快速链接 |
|----|---------|------|--------|---------|
| F005 | 结构分析与对比模块 | 🚧 部分完成 | 70% | [详情](./01_features/F005_structure_analysis/README.md) |
| F007 | 计算核对与透明化 | 🚧 部分完成 | 70% | [详情](./01_features/F007_calculation_verification/README.md) |

**P1功能状态**: 核心文件存在,功能可用,待增强交互和文档

#### 📈 P2 - 增强功能
| ID | 功能名称 | 状态 | 完整度 | 快速链接 |
|----|---------|------|--------|---------|
| F006 | 数据导出与分享模块 | 🚧 部分完成 | 70% | [详情](./01_features/F006_data_export/README.md) |

**P2功能状态**: 基础导出已实现,高级功能待补充

---

## 🏗️ 技术架构决策

> 记录关键技术选型和设计决策的"为什么"

### 已采纳决策

| ID | 决策标题 | 状态 | 影响范围 | 文档链接 |
|----|---------|------|---------|---------|
| ADR-001 | 状态管理选型 - Zustand | ✅ 已采纳 | F001, F002, F004 | [查看](./02_decisions/ADR-001_状态管理选型-Zustand.md) |
| ADR-002 | CSV解析策略 - 流式处理 | ✅ 已采纳 | F001 | [查看](./02_decisions/ADR-002_CSV解析策略-流式处理.md) |

### 待文档化决策

以下技术已在代码中采用,但缺少ADR文档:
- [ ] **ADR-003**: 数据验证架构 - Zod Schema
- [ ] **ADR-004**: 图表库选型 - Recharts
- [ ] **ADR-005**: UI组件库 - Shadcn/ui + Radix UI
- [ ] **ADR-006**: 数据持久化策略 - localStorage + IndexedDB

**行动项**: 补充上述ADR文档 (优先级: P1)

---

## 📝 最近更新

### 🔥 最新开发动态

#### 2025-01-28: TypeScript类型错误修复
- **类型**: Bug修复
- **影响范围**: F002, F005
- **关键变更**:
  - 修复 `comparison-analysis.tsx` 类型断言
  - 解决 Recharts 类型兼容性问题
  - 清理未使用的 `useCallback` 导入
- **结果**: ✅ TypeScript编译通过,生产构建成功
- **详情**: [03_logs/2025-01/2025-01-28_类型错误修复.md](./archive/修复总结-2025-10-20.md)

#### 2025-01-27: 大数据处理能力增强
- **类型**: 功能增强
- **影响范围**: F001
- **关键变更**:
  - 最大文件大小: 50MB → 200MB
  - 存储限制: 100MB → 500MB
  - 新增智能采样策略 (>10万行)
- **结果**: 支持100万行数据处理
- **详情**: [archive/PROGRESS.md](./archive/PROGRESS.md#2025-01-27)

#### 2025-01-20: CSV上传功能优化
- **类型**: Bug修复 + 性能优化
- **影响范围**: F001
- **关键变更**:
  - 调整字段顺序匹配实际CSV
  - 优化分块大小 (64KB动态调整)
  - 增强错误诊断日志
- **结果**: 16,968行数据解析成功
- **详情**: [CLAUDE.md#2025年1月更新](../../CLAUDE.md#2025年1月---csv上传功能优化)

---

## 🐛 问题与技术债务

### 当前已知问题 (0个)
✅ 所有已知问题已解决

### 历史问题记录

| ID | 问题描述 | 状态 | 解决日期 | 详情 |
|----|---------|------|---------|------|
| ISSUE-003 | 评级字段验证过严导致数据失败 | ✅ 已解决 | 2025-01-28 | [查看](./archive/问题记录表.md#issue-003) |
| ISSUE-004 | 调试文件过多影响整洁性 | ✅ 已解决 | 2025-01-28 | [查看](./archive/问题记录表.md#issue-004) |
| ISSUE-005 | TypeScript类型错误 | ✅ 已解决 | 2025-01-28 | [查看](./archive/问题记录表.md#issue-005) |

### 技术债务清单

#### 高优先级 (P0)
- [ ] **F001**: 补充批量上传的并行处理 (indicator: batch_upload)
- [ ] **F002**: 实现KPI公式工具提示展示 (indicator: formula_display)
- [ ] **F004**: 完成筛选器级联响应逻辑 (indicator: cascade)

#### 中优先级 (P1)
- [ ] **F003**: 优化异常检测算法展示 (indicator: anomaly_detection)
- [ ] **F004**: 实现筛选预设保存/加载 (indicator: presets)
- [ ] **F005**: 添加客户分群气泡图 (indicator: bubble_chart)

#### 低优先级 (P2)
- [ ] **F006**: 批量导出图表功能 (indicator: chart_export)
- [ ] **F007**: 计算过程透明化展示

**更新频率**: 每次运行 `analyze-codebase.js` 自动同步

---

## 🚀 下一步计划

### 短期目标 (1-2周)
1. **完成P0技术债务**: 将4个核心功能完整度提升至90%+
2. **补充缺失ADR**: 创建ADR-003至ADR-006文档
3. **性能优化**: 大数据集渲染性能测试和优化

### 中期目标 (1个月)
1. **智能分析功能**: 基于AI的数据洞察和异常归因
2. **移动端适配**: 响应式设计优化
3. **完善测试**: 单元测试覆盖率达到60%+

### 长期目标 (3个月)
1. **多租户支持**: 支持多个保险公司
2. **实时数据**: WebSocket实时数据更新
3. **高级分析**: 机器学习预测模型

---

## 📚 文档导航

### 按功能类别浏览
- **数据处理**
  - [F001: 数据导入](./01_features/F001_data_import/README.md) - CSV/JSON上传与解析
- **数据展示**
  - [F002: KPI看板](./01_features/F002_kpi_dashboard/README.md) - 8个核心指标
  - [F003: 趋势分析](./01_features/F003_trend_analysis/README.md) - 52周时间序列
- **数据分析**
  - [F004: 筛选器](./01_features/F004_filters/README.md) - 11个业务维度
  - [F005: 结构分析](./01_features/F005_structure_analysis/README.md) - 对比与分群
- **数据导出**
  - [F006: 数据导出](./01_features/F006_data_export/README.md) - CSV/PNG/PDF
- **系统功能**
  - [F007: 计算验证](./01_features/F007_calculation_verification/README.md) - 公式透明化

### 按开发阶段浏览
- **需求分析**: [原始PRD文档](./archive/PRD-best.md)
- **技术决策**: [02_decisions/](./02_decisions/)
- **开发记录**: [archive/PROGRESS.md](./archive/PROGRESS.md)
- **测试记录**: [archive/测试记录/](./archive/)

---

## 🛠️ 开发者指南

### 快速开始
```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 构建生产版本
pnpm build

# 运行代码分析
node analyze-codebase.js
```

### 工作流程
1. **开发新功能** → 编写代码 → 提交代码
2. **运行分析工具** → `node analyze-codebase.js`
3. **检查报告** → 查看 `codebase-analysis.json`
4. **更新文档** → 更新功能卡片 `meta.json` 和 `README.md`
5. **同步仪表盘** → 本文档自动反映最新状态

### 文档维护规范
- ✅ **DO**: 代码变更后立即更新相关功能卡片
- ✅ **DO**: 重大技术决策创建新ADR文档
- ✅ **DO**: 每周运行一次 `analyze-codebase.js`
- ❌ **DON'T**: 基于"记忆"标记功能状态
- ❌ **DON'T**: 保留与代码不符的文档

详见: [协作约定](./00_conventions.md)

---

## 📊 代码统计

### 项目规模
- **总代码行数**: ~15,000行
- **组件数量**: 50+ 个
- **Hook数量**: 20+ 个
- **工具函数**: 30+ 个
- **测试覆盖率**: 待补充

### 技术栈详情
```json
{
  "运行时": "Node.js 20.x LTS",
  "框架": "Next.js 14.2.33 + React 18.3.1",
  "语言": "TypeScript 5.9.3",
  "状态管理": "Zustand 5.0.8",
  "数据验证": "Zod 4.1.12",
  "图表库": "Recharts 3.3.0",
  "UI组件": "Tailwind CSS 3.4.18 + Shadcn/ui",
  "CSV解析": "Papa Parse 5.5.3"
}
```

---

## 📞 支持与反馈

### 报告问题
1. 运行 `node analyze-codebase.js` 确认问题
2. 创建Issue记录到 `03_logs/issues/`
3. 在相关功能卡片中引用Issue

### 贡献指南
1. 阅读 [协作约定](./00_conventions.md)
2. 理解"代码优先"原则
3. 提交PR前确保文档同步

### 联系方式
- **项目负责人**: 开发团队
- **技术支持**: GitHub Issues
- **文档维护**: 开发团队

---

## 🔄 自动化工具

### 代码分析工具
```bash
# 扫描src/目录,分析功能实现状态
node analyze-codebase.js

# 输出: codebase-analysis.json
# - 功能完整度
# - 架构模式识别
# - 文件存在性检查
```

### 功能卡片生成
```bash
# 基于分析报告自动生成/更新功能卡片
node generate-feature-cards.js

# 输出: 开发文档/01_features/F{001-007}_*/
# - README.md (功能文档)
# - meta.json (元数据)
```

### 元数据验证 (规划中)
```bash
# 验证所有meta.json格式和链接有效性
node validate-metadata.js
```

---

## 📈 版本历史

| 版本 | 日期 | 重大变更 | 文档维护者 |
|------|------|---------|-----------|
| v1.0 | 2025-01-20 | 知识库重构,建立"代码优先"体系 | Claude AI |
| v0.9 | 2025-01-28 | TypeScript错误修复,项目结构优化 | 开发团队 |
| v0.8 | 2025-01-27 | 大数据处理增强 | 开发团队 |
| v0.7 | 2025-01-20 | CSV上传功能优化 | 开发团队 |

---

*本文档自动生成于: 2025-01-20 23:58 UTC*
*基于代码分析报告: codebase-analysis.json*
*知识库版本: v1.0.0*
*维护者: 开发团队*
