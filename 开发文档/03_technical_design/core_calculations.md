# 核心指标计算引擎 V2.0

本文件定义了平台最终确定的16个核心KPI的计算公式、业务逻辑和显示规则，是对早期版本的全面升级和修正。

## 1. 核心原则

- **数据驱动**: 所有KPI均源自 `InsuranceData` 基础数据。
- **一致性**: 命名、单位和计算逻辑在整个平台保持统一。
- **可追溯**: 每个指标的计算路径清晰，便于验证和调试。

## 2. KPI完整清单 (4x4网格布局)

### 第一行：核心比率指标

| KPI名称 | 计算公式 | 业务说明 |
| :--- | :--- | :--- |
| **满期边际贡献率** | `100% - 变动成本率` | **盈利能力核心**。衡量最终的盈利空间，是盈利能力的结果指标。 |
| **保费时间进度达成率** | `当期签单保费 / (年度目标保费 / 365 * 当期天数)` | 衡量保费收入与年度目标的匹配程度。 |
| **满期赔付率** | `满期赔付 / 满期保费` | 反映赔付支出占满期保费的比例。 |
| **费用率** | `总费用 / 签单保费` | 衡量获取和管理业务所需成本的效率。 |

### 第二行：核心金额指标

| KPI名称 | 计算公式 | 业务说明 |
| :--- | :--- | :--- |
| **满期边际贡献额** | `满期保费 * 满期边际贡献率` | **利润绝对值**。定位利润的绝对值贡献来源。 |
| **签单保费** | `SUM(签单保费)` | 业务规模的核心体现。 |
| **已报告赔款** | `SUM(已报告赔款)` | 已发生并上报的赔案金额。 |
| **费用额** | `SUM(总费用)` | 业务相关的总费用支出。 |

### 第三行：结构与效率指标

| KPI名称 | 计算公式 | 业务说明 |
| :--- | :--- | :--- |
| **变动成本率** | `满期赔付率 + 费用率` | **成本控制能力**。诊断成本端的整体表现。 |
| **满期率** | `满期保费 / 签单保费` | 反映当期保费中已实现风险价值的部分。 |
| **满期出险率** | `赔案件数 / 满期保单数` | 衡量已满期保单的出险频率。 |
| **保单件数** | `COUNT(保单)` | 业务规模的辅助指标。 |

### 第四行：单均质量指标

| KPI名称 | 计算公式 | 业务说明 |
| :--- | :--- | :--- |
| **赔案件数** | `COUNT(赔案)` | 赔付发生的频率。 |
| **单均保费** | `签单保费 / 保单件数` | **业务质量**。衡量平均每张保单的保费收入。 |
| **案均赔款** | `已报告赔款 / 赔案件数` | **风险成本**。衡量平均每起赔案的赔付金额。 |
| **单均费用** | `总费用 / 保单件数` | **运营效率**。衡量平均每张保单的费用成本。 |

## 3. 边贡分析专题计算逻辑

边贡分析模块是对核心盈利指标的深度下钻，包含以下四个维度的计算：

1.  **满期边贡率 (盈利能力结果)**
    - **公式**: `100% - 变动成本率`
    - **解读**: 每100元满期保费的净剩余。

2.  **变动成本率 (成本控制能力)**
    - **公式**: `满期赔付率 + 费用率`
    - **解读**: 业务的直接成本结构。

3.  **满期边贡额 (利润绝对值)**
    - **公式**: `满期保费 * 满期边际贡献率`
    - **解读**: 利润的绝对贡献额。

4.  **单均边贡额 (盈利质量)**
    - **公式**: `(满期边贡额 * 10000) / 保单件数`
    - **解读**: 判断增长是否为高质量的盈利性增长。

## 4. 保费时间进度达成率计算规则（50周制）

### 4.1 中国特色：50周工作制

考虑到中国保险业务的实际运营规律，年度目标分配采用**50周工作制**：
- **春节长假**：约1周
- **国庆长假**：约1周
- **实际工作周数**：52 - 2 = **50周**

因此，**周计划 = 年度目标 ÷ 50**

### 4.2 两种计算模式

#### 模式A：当周值模式（累计视角）
```
保费时间进度达成率 = (实际签单保费累计 / 年度目标保费) / (已过天数 / 365) × 100%
```

**示例**：
- 年度目标：10,000万元
- 第42周结束日：2025-10-18（已过292天，时间进度 = 80%）
- 实际累计保费：8,500万元（完成率 = 85%）
- **时间进度达成率 = 85% / 80% = 106.25%**（超前于时间进度）

#### 模式B：周增量模式（单周视角）
```
保费时间进度达成率 = 周增量 / 周计划 × 100%
其中：周计划 = 年度目标 ÷ 50
```

**示例**：
- 年度目标：10,000万元
- 周计划：10,000 ÷ 50 = 200万元/周
- 第42周实际增量：215万元
- **时间进度达成率 = 215 / 200 = 107.5%**（本周超额完成）

### 4.3 周次与日期映射规则

**规则**：第1周从1月1日开始，到第一个周六结束。

**2025年示例**：
- 第1周：2025-01-01（周三）~ 2025-01-04（周六）= 4天
- 第2周：2025-01-05（周日）~ 2025-01-11（周六）= 7天
- 第42周：2025-10-13（周一）~ 2025-10-18（周六）= 7天

**计算公式**：
```javascript
第N周结束日 = 第1周结束日 + (N-1) × 7天
已过天数 = 从1月1日到第N周结束日的天数
```

**关键实现细节**：
- 使用UTC时间避免时区问题
- 第1周可能不足7天（取决于1月1日是星期几）
- 所有后续周均为完整的7天（周日-周六）

## 5. 数据聚合与显示规则

- **数据聚合**: 所有指标均支持按时间、机构、业务类型等维度进行聚合和筛选。
- **环比计算**: 所有KPI均提供与上期（周/月）的**绝对增量**和**百分比变化**对比。智能跳过缺失周期（最多往前查找5周）。
- **颜色编码**:
    - **正向指标** (如边贡率、单均保费): 越高越好，使用绿色系表示优秀。
    - **逆向指标** (如赔付率、费用率): 越低越好，使用红色系表示风险。
    - **中性指标** (如签单保费): 通常不设颜色，或使用灰色系。
- **显示格式**:
    - **比率**: 通常保留1-2位小数的百分比。
    - **金额**: 通常以"万"为单位，保留0-2位小数。
    - **数量**: 整数。

## 6. 文档状态

- **版本**: 3.0
- **最后更新**: 2025-10-21
- **状态**: ✅ **现行标准**
- **重要更新**: 新增50周工作制、周次日期映射规则、保费时间进度达成率双模式计算

## 6. 相关文档

本计算引擎的定义和实现，其需求、设计和测试记录分散在以下文档中：

- **[KPI看板 4x4网格布局 - 测试记录](../archive/KPI看板-4x4网格布局-测试记录.md)**: 定义了16个核心KPI的完整布局、计算逻辑和颜色编码规则。
- **[紧凑版KPI看板测试记录 V2.0](../archive/紧凑版KPI看板测试记录-V2.md)**: 详细说明了紧凑模式下的KPI展示方式、交互逻辑和性能优化，其计算核心与4x4网格布局一致。
- **[边贡分析模块改造测试记录](../archive/边贡分析模块改造测试记录.md)**: 深入阐述了“边际贡献”相关指标的计算逻辑和业务解读。