# 核心指标计算逻辑

本文档定义了车险分析平台中关键绩效指标（KPI）的计算公式和业务逻辑，确保所有分析结果的一致性和准确性。

## 核心KPI计算公式

所有KPI的计算均基于从 `insurance_records` 表中筛选出的数据集。

### 1. 综合成本率 (Combined Ratio)

**定义**: 衡量保险公司承保业务盈利能力的核心指标。

**公式**:
```
综合成本率 = (满期保费 > 0) ? (已报告赔款 + 费用金额) / 满期保费 : 0
```

- **分子**: `已报告赔款` (`reported_claim_payment_yuan`) + `费用金额` (`expense_amount_yuan`)
- **分母**: `满期保费` (`matured_premium_yuan`)
- **边界条件**: 如果 `满期保费` 为0或负数，则综合成本率记为0，以避免除以零的错误。

### 2. 综合赔付率 (Combined Claim Ratio)

**定义**: 衡量赔款支出占保费收入比例的指标。

**公式**:
```
综合赔付率 = (满期保费 > 0) ? 已报告赔款 / 满期保费 : 0
```

- **分子**: `已报告赔款` (`reported_claim_payment_yuan`)
- **分母**: `满期保费` (`matured_premium_yuan`)
- **边界条件**: 如果 `满期保费` 为0或负数，则综合赔付率记为0。

### 3. 综合费用率 (Combined Expense Ratio)

**定义**: 衡量费用支出占保费收入比例的指标。

**公式**:
```
综合费用率 = (签单保费 > 0) ? 费用金额 / 签单保费 : 0
```

- **分子**: `费用金额` (`expense_amount_yuan`)
- **分母**: `签单保费` (`signed_premium_yuan`)
- **边界条件**: 如果 `签单保费` 为0或负数，则综合费用率记为0。

### 4. 签单进度 (Signing Progress)

**定义**: 衡量实际签单保费与计划保费的完成情况。

**公式**:
```
签单进度 = (保费计划 > 0) ? 签单保费 / 保费计划 : 0
```

- **分子**: `签单保费` (`signed_premium_yuan`)
- **分母**: `保费计划` (`premium_plan_yuan`)
- **边界条件**: 如果 `保费计划` 为0或负数，则签单进度记为0。

### 5. 边际贡献率 (Marginal Contribution Rate)

**定义**: 衡量业务带来的边际收益占保费收入的比例。

**公式**:
```
边际贡献率 = (签单保费 > 0) ? 边际贡献额 / 签单保费 : 0
```

- **分子**: `边际贡献额` (`marginal_contribution_amount_yuan`)
- **分母**: `签单保费` (`signed_premium_yuan`)
- **边界条件**: 如果 `签单保费` 为0或负数，则边际贡献率记为0。

## 数据聚合逻辑

- **汇总计算**: 在进行多维度分析时，所有指标（如 `signed_premium_yuan`, `matured_premium_yuan` 等）都通过 **SUM** 函数进行聚合。
- **分组依据**: 使用 `GROUP BY` 子句，根据用户在前端选择的维度（如 `third_level_organization`, `insurance_type` 等）对数据进行分组。
- **时间范围过滤**: 所有查询都将基于用户选择的 `snapshot_date` 范围进行过滤。